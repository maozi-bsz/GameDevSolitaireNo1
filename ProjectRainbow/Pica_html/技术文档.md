# æ— äººçº¢è‰²çš®å¡çš„å®‰ä¿ä¹‹æ—… - æŠ€æœ¯æ–‡æ¡£

## ğŸ“ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
Pica_html/
â”œâ”€â”€ index.html              # æ¸¸æˆä¸»èœå•é¡µé¢
â”œâ”€â”€ game.html               # ä¸»æ¸¸æˆé¡µé¢
â”œâ”€â”€ js/                     # æ ¸å¿ƒJavaScriptä»£ç ç›®å½•
â”‚   â”œâ”€â”€ game_config/        # æ¸¸æˆé…ç½®å’Œæ•°æ®
â”‚   â”œâ”€â”€ game_system/        # æ ¸å¿ƒç³»ç»Ÿæ¨¡å—
â”‚   â”œâ”€â”€ game_show/          # æ˜¾ç¤ºå’ŒåŠ¨ç”»æ¨¡å—
â”‚   â”œâ”€â”€ gameplay/           # æ¸¸æˆç©æ³•é€»è¾‘
â”‚   â””â”€â”€ text.js             # ä¸»æ§åˆ¶è„šæœ¬
â”œâ”€â”€ README.md               # å¼€å‘è€…æŒ‡å—
â”œâ”€â”€ æ¸¸æˆå®Œæ•´æ–‡æ¡£.md          # è¯¦ç»†æ¸¸æˆæ–‡æ¡£
â”œâ”€â”€ å…¨æ–°æ¸¸æˆæ–‡æ¡£.md          # æœ¬æŠ€æœ¯æ–‡æ¡£
â””â”€â”€ é¡¹ç›®è¯´æ˜.md             # é¡¹ç›®æ¦‚è¦è¯´æ˜
```

## ğŸ® æ ¸å¿ƒç³»ç»Ÿæ¶æ„

### 1. æ¸¸æˆçŠ¶æ€ç®¡ç†ç³»ç»Ÿ
**æ–‡ä»¶**ï¼š`js/game_system/game-state.js`

ç®¡ç†æ¸¸æˆçš„ä¸‰å¤§æ ¸å¿ƒçŠ¶æ€å¯¹è±¡ï¼š

```javascript
// æ¸¸æˆè¿›ç¨‹çŠ¶æ€
let gameState = {
  textCount: 0,                    // æ–‡æœ¬è®¡æ•°å™¨
  mileage: 0,                      // è¡Œé©¶é‡Œç¨‹
  triggeredEvents: [],             // å·²è§¦å‘äº‹ä»¶è®°å½•
  passengerFavor: {},              // ä¹˜å®¢å¥½æ„Ÿåº¦æ˜ å°„
  unlockedAchievements: [],        // æˆå°±è§£é”çŠ¶æ€
  // ... å…¶ä»–çŠ¶æ€å­—æ®µ
};

// è½¦è¾†çŠ¶æ€
let truckState = {
  passengers: [],                  // å½“å‰ä¹˜å®¢åˆ—è¡¨
  fuel: 100,                       // ç‡ƒæ²¹é‡ (0-100)
  durability: 100,                 // è€ä¹…åº¦ (0-100)
  comfort: 100,                    // èˆ’é€‚åº¦ (0-100)
  wheelState: 1                    // è½®å­åŠ¨ç”»çŠ¶æ€
};

// åº“å­˜çŠ¶æ€
let inventoryState = {
  gold: 6,                         // é‡‘å¸æ•°é‡
  maxWeight: 50,                   // æœ€å¤§è½½é‡
  items: []                        // ç‰©å“åˆ—è¡¨
};
```

### 2. äº‹ä»¶å¤„ç†ç³»ç»Ÿ
**æ–‡ä»¶**ï¼š`js/gameplay/event-handler.js`

æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š
- äº‹ä»¶è§¦å‘æ£€æŸ¥å’Œè°ƒåº¦
- äº‹ä»¶æ¡ä»¶éªŒè¯å’Œç­›é€‰
- ç©å®¶é€‰æ‹©å¤„ç†å’Œæ•ˆæœåº”ç”¨
- å¤åˆæ•ˆæœè§£æï¼ˆæƒé‡ã€æ¦‚ç‡ã€åºåˆ—ç­‰ï¼‰

**å…³é”®å‡½æ•°**ï¼š
```javascript
function checkEventTrigger()          // æ£€æŸ¥æ˜¯å¦è§¦å‘äº‹ä»¶
function findAvailableEvent()         // æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„äº‹ä»¶
function triggerEvent(event)          // è§¦å‘å…·ä½“äº‹ä»¶
function processEffects(effects)      // å¤„ç†äº‹ä»¶æ•ˆæœ
function applyBasicEffect(effect)     // åº”ç”¨åŸºç¡€æ•ˆæœ
```

### 3. æ˜¾ç¤ºæ¸²æŸ“ç³»ç»Ÿ
**æ–‡ä»¶**ï¼š`js/game_show/`

åŒ…å«å¤šä¸ªä¸“é—¨çš„æ˜¾ç¤ºæ¨¡å—ï¼š

#### çš®å¡æ˜¾ç¤º (`truck-display.js`)
```javascript
function updateTruckDisplay()         // æ›´æ–°çš®å¡è§†è§‰æ˜¾ç¤º
function startWheelAnimation()        // å¯åŠ¨è½®å­åŠ¨ç”»
function stopWheelAnimation()         // åœæ­¢è½®å­åŠ¨ç”»
```

#### é“è·¯åŠ¨ç”» (`road.js`)
```javascript
function initRoad()                   // åˆå§‹åŒ–é“è·¯æ˜¾ç¤º
function updateRoad()                 // æ›´æ–°é“è·¯æ»šåŠ¨åŠ¨ç”»
```

#### åº“å­˜æ˜¾ç¤º (`inventory-display.js`)
```javascript
function initInventoryDisplay()       // åˆå§‹åŒ–åº“å­˜ç•Œé¢
function updateInventoryDisplay()     // æ›´æ–°ç‰©å“æ˜¾ç¤º
function inventoryDragOver()          // æ‹–æ‹½æ‚¬åœå¤„ç†
function inventoryDrop()              // æ‹–æ‹½æ”¾ç½®å¤„ç†
```

### 4. å­˜æ¡£ç³»ç»Ÿ
**æ–‡ä»¶**ï¼š`js/game_system/save-system.js`

é‡‡ç”¨åŒé‡å­˜å‚¨æœºåˆ¶ï¼š
- **Cookie**ï¼šä¿å­˜æ¸¸æˆè¿›åº¦ï¼ˆæ—¶æ•ˆæ€§æ•°æ®ï¼‰
- **localStorage**ï¼šä¿å­˜è·¨æ¡£æ•°æ®ï¼ˆæˆå°±ã€è®°å½•ç­‰ï¼‰

```javascript
function saveGame()                   // ä¿å­˜æ¸¸æˆçŠ¶æ€
function loadGame()                   // åŠ è½½æ¸¸æˆçŠ¶æ€
function saveToStorage(key, data)     // localStorageå­˜å‚¨
function loadFromStorage(key)         // localStorageè¯»å–
```

## ğŸ¯ é…ç½®ç³»ç»Ÿè¯¦è§£

### æ¸¸æˆå…¨å±€é…ç½®
**æ–‡ä»¶**ï¼š`js/game_config/game-config.js`

```javascript
const GAME_CONFIG = {
  triggerInterval: 2,                 // äº‹ä»¶è§¦å‘é—´éš”ï¼ˆè¡Œæ•°ï¼‰
  textSpeed: 1500,                    // æ–‡æœ¬ç”Ÿæˆé€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
  overnightRestInterval: 25,          // å¼ºåˆ¶ä¼‘æ¯é—´éš”ï¼ˆå…¬é‡Œï¼‰
  fuelConsumptionPer5km: 1.2,         // ç‡ƒæ²¹æ¶ˆè€—ç‡
  initialGold: 6,                     // åˆå§‹é‡‘å¸
  cookieExpiryDays: 3650,             // å­˜æ¡£æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰
  // åŠ¨ç”»é…ç½®
  animation: {
    roadDeceleration: 300,
    charSlideIn: 400,
    charStay: 1000
  }
};
```

### ä¹˜å®¢é…ç½®
**æ–‡ä»¶**ï¼š`js/game_config/passenger-config.js`

```javascript
const PASSENGER_CONFIG = {
  "é¹¿": {
    displayChars: ["é¹¿"],              // æ˜¾ç¤ºå­—ç¬¦
    color: "#d4a574",                 // æ˜¾ç¤ºé¢œè‰²
    positions: [[3, 8], [3, 9]],      // åœ¨çš®å¡ä¸Šçš„ä½ç½®åæ ‡
    specialAbility: "forest_spirit"   // ç‰¹æ®Šèƒ½åŠ›æ ‡è¯†
  }
  // ... å…¶ä»–ä¹˜å®¢é…ç½®
};
```

### ç‰©å“é…ç½®
**æ–‡ä»¶**ï¼š`js/game_config/items-config.js`

```javascript
const ITEMS_CONFIG = {
  "æ²¹æ¡¶": {
    name: "æ²¹æ¡¶",
    color: "#facc15",
    description: "é«˜å“è´¨ç‡ƒæ²¹ï¼Œæ¢å¤å¤§é‡ç‡ƒæ²¹ã€‚",
    weight: 10,
    category: "consumable",
    useEffect: { fuel: 50 },          // ä½¿ç”¨æ•ˆæœ
    stackable: true                   // æ˜¯å¦å¯å †å 
  }
  // ... å…¶ä»–ç‰©å“é…ç½®
};
```

### äº‹ä»¶é…ç½®ç»“æ„
**ç¤ºä¾‹**ï¼š`js/game_config/events/events-encounter.js`

```javascript
const EVENTS_ENCOUNTER = {
  deer: {
    id: "deer",
    title: "å‰æ–¹å‘ç°ä¸€åªé¹¿ï¼",
    description: "ä¸€åªè¿·è·¯çš„é¹¿ç«™åœ¨å…¬è·¯ä¸­å¤®...",
    image: "é¹¿ï¼",
    triggerWeight: 15,                // è§¦å‘æƒé‡
    oneTime: true,                    // æ˜¯å¦ä¸€æ¬¡æ€§äº‹ä»¶
    condition: null,                  // è§¦å‘æ¡ä»¶
    choices: [                        // é€‰æ‹©é€‰é¡¹
      {
        id: "invite",
        text: "æ¥å—è¿™ä¸ªå§”æ‰˜ï¼",
        description: "æ‰“å¼€è½¦é—¨ï¼Œé‚€è¯·é¹¿æˆä¸ºæ—…é€”ä¼™ä¼´",
        result: {
          message: "é¹¿é«˜å…´åœ°è·³ä¸Šäº†åè½¦å¢ï¼",
          effects: {
            addPassenger: "é¹¿",
            unlockEvents: ["hunter"],
            comfort: -8
          }
        }
      }
      // ... å…¶ä»–é€‰é¡¹
    ]
  }
};
```

## ğŸ”§ å¼€å‘æ‰©å±•æŒ‡å—

### æ–°å¢äº‹ä»¶æ­¥éª¤
1. åœ¨å¯¹åº”äº‹ä»¶æ–‡ä»¶ä¸­æ·»åŠ äº‹ä»¶å¯¹è±¡
2. è®¾ç½®åˆé€‚çš„è§¦å‘æƒé‡å’Œæ¡ä»¶
3. å®šä¹‰é€‰æ‹©é€‰é¡¹å’Œæ•ˆæœ
4. ç¡®ä¿åœ¨`events-index.js`ä¸­è¢«å¼•ç”¨

### æ–°å¢ä¹˜å®¢æ­¥éª¤
1. åœ¨`passenger-config.js`ä¸­æ·»åŠ ä¹˜å®¢é…ç½®
2. å®šä¹‰æ˜¾ç¤ºæ ·å¼å’Œç‰¹æ®Šèƒ½åŠ›
3. åœ¨ç›¸å…³äº‹ä»¶ä¸­æ·»åŠ ä¸Šä¸‹è½¦é€»è¾‘
4. æ›´æ–°æˆå°±ç³»ç»Ÿä¸­çš„ä¹˜å®¢ç›¸å…³æˆå°±

### æ–°å¢ç‰©å“æ­¥éª¤
1. åœ¨`items-config.js`ä¸­æ·»åŠ ç‰©å“å®šä¹‰
2. è®¾ç½®é‡é‡ã€ç±»åˆ«å’Œä½¿ç”¨æ•ˆæœ
3. å¦‚éœ€åˆæˆï¼Œåœ¨`CRAFTING_RECIPES`ä¸­æ·»åŠ é…æ–¹
4. æ›´æ–°UIæ˜¾ç¤ºå’Œäº¤äº’é€»è¾‘

### å¹³è¡¡è°ƒæ•´æ–¹æ³•
- **äº‹ä»¶é¢‘ç‡**ï¼šä¿®æ”¹`GAME_CONFIG.triggerInterval`æˆ–äº‹ä»¶æƒé‡
- **èµ„æºæ¶ˆè€—**ï¼šè°ƒæ•´`fuelConsumptionPer5km`ç­‰å‚æ•°
- **ç‰©å“æ•ˆæœ**ï¼šä¿®æ”¹`ITEMS_CONFIG`ä¸­çš„`useEffect`
- **å•†äººä»·æ ¼**ï¼šç¼–è¾‘`merchant-config.js`ä¸­çš„ä»·æ ¼è®¾ç½®

## ğŸ¨ è§†è§‰ç³»ç»ŸæŠ€æœ¯ç»†èŠ‚

### åŠ¨ç”»å®ç°
ä½¿ç”¨CSSå…³é”®å¸§åŠ¨ç”»é…åˆJavaScriptæ§åˆ¶ï¼š

```css
/* è½®å­è½¬åŠ¨åŠ¨ç”» */
@keyframes wheelRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* å±å¹•æŠ–åŠ¨æ•ˆæœ */
@keyframes screenShake {
  0%, 100% { transform: translate(0, 0); }
  15% { transform: translate(-4px, 2px); }
  30% { transform: translate(4px, -2px); }
  /* ... æ›´å¤šå…³é”®å¸§ */
}
```

### å“åº”å¼è®¾è®¡
ä½¿ç”¨å®¹å™¨æŸ¥è¯¢å®ç°è‡ªé€‚åº”å¸ƒå±€ï¼š
```css
#game-canvas {
  container-type: size;
  container-name: game;
}

.event-modal-inner {
  width: 96%;
  max-width: 96%;
  font-size: clamp(0.875rem, 3.5cqw, 1.5rem);
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

### å†…å­˜ç®¡ç†
- åŠæ—¶æ¸…ç†DOMäº‹ä»¶ç›‘å¬å™¨
- åˆç†ä½¿ç”¨é—­åŒ…é¿å…å†…å­˜æ³„æ¼
- å®šæœŸæ¸…ç†è¿‡æœŸçš„å®šæ—¶å™¨

### æ¸²æŸ“ä¼˜åŒ–
- ä½¿ç”¨`requestAnimationFrame`ä¼˜åŒ–åŠ¨ç”»
- æ‰¹é‡æ›´æ–°DOMå‡å°‘é‡æ’é‡ç»˜
- åˆç†ä½¿ç”¨CSS transformè€Œéæ”¹å˜å¸ƒå±€å±æ€§

### æ•°æ®å­˜å‚¨ä¼˜åŒ–
- å‹ç¼©å­˜æ¡£æ•°æ®ç»“æ„
- åˆç†è®¾ç½®Cookieå’ŒlocalStorageçš„è¿‡æœŸæ—¶é—´
- é¿å…å­˜å‚¨å†—ä½™æ•°æ®

## ğŸ› è°ƒè¯•å’Œæµ‹è¯•

### å¼€å‘è€…å·¥å…·
- æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•
- æ€§èƒ½ç›‘æ§é¢æ¿
- ç½‘ç»œè¯·æ±‚ç›‘æ§

### å¸¸è§é—®é¢˜æ’æŸ¥
- å­˜æ¡£åŠ è½½å¤±è´¥ï¼šæ£€æŸ¥Cookieå¤§å°é™åˆ¶
- äº‹ä»¶ä¸è§¦å‘ï¼šéªŒè¯è§¦å‘æ¡ä»¶å’Œæƒé‡è®¾ç½®
- æ˜¾ç¤ºå¼‚å¸¸ï¼šç¡®è®¤é…ç½®æ–‡ä»¶æ­£ç¡®åŠ è½½
- åŠ¨ç”»å¡é¡¿ï¼šä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

## ğŸ”’ å®‰å…¨è€ƒè™‘

### å®¢æˆ·ç«¯å®‰å…¨
- è¾“å…¥éªŒè¯å’Œ sanitization
- é˜²æ­¢XSSæ”»å‡»
- å­˜æ¡£æ•°æ®å®Œæ•´æ€§æ ¡éªŒ

### æ•°æ®ä¿æŠ¤
- ç”¨æˆ·éšç§ä¿æŠ¤
- æœ¬åœ°å­˜å‚¨æ•°æ®åŠ å¯†
- æ•æ„Ÿä¿¡æ¯å¤„ç†

---

**æŠ€æœ¯æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2026å¹´2æœˆ  
**é€‚ç”¨æ¸¸æˆç‰ˆæœ¬**ï¼šå½“å‰ç¨³å®šç‰ˆ