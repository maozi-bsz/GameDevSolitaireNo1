<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <title>无人红色皮卡的安保之旅</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'chinese': ['Microsoft YaHei', 'SimHei', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-in',
                        'fade-out': 'fadeOut 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeOut: {
                            '0%': { opacity: '1', transform: 'translateY(0)' },
                            '100%': { opacity: '0', transform: 'translateY(-30px)' },
                        },
                    },
                },
            },
        }
    </script>
    <style>
        body {
            background: #171717;
        }
        .text-area-scroll {
            scrollbar-width: thin;
            scrollbar-color: #c41e3a #1f2937;
        }
        .text-area-scroll::-webkit-scrollbar { width: 10px; }
        .text-area-scroll::-webkit-scrollbar-track { background: #1f2937; border-radius: 0 10px 10px 0; }
        .text-area-scroll::-webkit-scrollbar-thumb { background: #c41e3a; border-radius: 10px; }
        .text-area-scroll::-webkit-scrollbar-thumb:hover { background: #e63950; }
    </style>
</head>
<body class="min-h-screen flex justify-center items-center overflow-hidden font-chinese">
    <div class="decoration absolute top-[10%] left-[10%] opacity-10 text-[10rem] text-white pointer-events-none">小</div>
    <div class="decoration absolute top-[50%] left-[5%] opacity-10 text-[10rem] text-white pointer-events-none">心</div>
    <div class="decoration absolute top-[20%] right-[15%] opacity-10 text-[10rem] text-white pointer-events-none">福</div>
    <div class="decoration absolute bottom-[10%] right-[10%] opacity-10 text-[10rem] text-white pointer-events-none">瑞</div>
    
    <div class="text-center animate-fade-in" id="container">
        <h1 class="text-6xl text-gray-200 mb-4 tracking-[0.5rem] drop-shadow-[0_0_20px_rgba(196,30,58,0.5)]">
            无人红色皮卡的安保之旅
        </h1>
        <div class="flex flex-col items-center gap-4 mt-16">
            <button 
                onclick="startGame()"
                class="px-16 py-5 text-2xl font-bold text-white uppercase tracking-[0.3rem] rounded-full cursor-pointer transition-all duration-300 ease-in-out shadow-[0_10px_30px_rgba(196,30,58,0.4)] bg-gradient-to-br from-[#c41e3a] to-[#8b0000] hover:-translate-y-1 hover:shadow-[0_15px_40px_rgba(196,30,58,0.6)] hover:bg-gradient-to-br hover:from-[#e63950] hover:to-[#c41e3a] active:-translate-y-0.5"
            >
                START
            </button>
            <button 
                onclick="resetGame()"
                class="px-8 py-3 text-sm font-bold text-gray-400 uppercase tracking-[0.2rem] rounded-full cursor-pointer transition-all duration-300 border-2 border-gray-600 hover:border-[#c41e3a] hover:text-[#c41e3a]"
            >
                重置游戏
            </button>
            <button 
                onclick="showAchievements()"
                class="px-8 py-3 text-sm font-bold text-gray-400 uppercase tracking-[0.2rem] rounded-full cursor-pointer transition-all duration-300 border-2 border-gray-600 hover:border-[#c41e3a] hover:text-[#c41e3a]"
            >
                成就
            </button>
            <button 
                onclick="showJourneyHistory()"
                class="px-8 py-3 text-sm font-bold text-gray-400 uppercase tracking-[0.2rem] rounded-full cursor-pointer transition-all duration-300 border-2 border-gray-600 hover:border-[#c41e3a] hover:text-[#c41e3a]"
            >
                历史历程
            </button>
        </div>
        <p class="mt-5 text-gray-600 text-base tracking-[0.2rem]">点击开始公路之旅</p>
    </div>

    <script src="js/game_config/achievements-config.js"></script>
    <script>
        function startGame() {
            document.getElementById('container').classList.remove('animate-fade-in');
            document.getElementById('container').classList.add('animate-fade-out');
            setTimeout(() => {
                window.location.href = 'game.html';
            }, 500);
        }

        function resetGame() {
            if (!confirm('确定要重置游戏吗？将清除所有存档、成就、结局记录、历史里程和历史历程，此操作不可恢复。')) {
                return;
            }
            
            // 清除游戏存档 Cookie
            document.cookie = 'chinese_truck_adventure_save=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            
            // 清除成就、结局、里程记录（localStorage 跨档数据）
            try {
                localStorage.removeItem('chinese_truck_adventure_achievements');
                localStorage.removeItem('chinese_truck_adventure_endings');
                localStorage.removeItem('chinese_truck_adventure_mileage_best');
                localStorage.removeItem('chinese_truck_adventure_journey_history');
            } catch (e) {}
            
            // 显示提示
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = '已重置！';
            btn.classList.add('text-[#c41e3a]', 'border-[#c41e3a]');
            
            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove('text-[#c41e3a]', 'border-[#c41e3a]');
            }, 2000);
        }

        function showAchievements() {
            // 从 localStorage 加载成就
            let unlockedAchievements = [];
            try {
                const saved = localStorage.getItem("chinese_truck_adventure_achievements");
                if (saved) {
                    unlockedAchievements = JSON.parse(saved);
                }
            } catch (e) {}

            if (typeof ACHIEVEMENTS_CONFIG === "undefined") {
                alert("成就系统未加载");
                return;
            }

            const allAchievements = Object.values(ACHIEVEMENTS_CONFIG);
            const unlockedSet = new Set(unlockedAchievements);
            
            let html = '<div class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 overflow-y-auto p-4">';
            html += '<div class="bg-[#1a1a2e] border-2 border-[#c41e3a] rounded-xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto text-area-scroll">';
            html += '<h2 class="text-3xl font-bold text-[#c41e3a] mb-6 text-center">成就列表</h2>';
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            
            allAchievements.forEach((ach) => {
                const isUnlocked = unlockedSet.has(ach.id);
                const isHiddenLocked = ach.hidden && !isUnlocked;
                const displayIcon = isHiddenLocked ? '???' : (isUnlocked ? ach.icon : '❓');
                const displayTitle = ach.title;
                const displayDesc = isHiddenLocked ? '???' : ach.description;
                const showUnlockedHint = !isUnlocked && !ach.hidden;
                html += '<div class="p-4 rounded-lg border-2 ' + 
                    (isUnlocked ? 'border-[#c41e3a] bg-gray-800/50' : 'border-gray-700 bg-gray-900/30 opacity-60') + '">';
                html += '<div class="flex items-center gap-3">';
                html += '<span class="text-2xl">' + displayIcon + '</span>';
                html += '<div class="flex-1">';
                html += '<div class="text-lg font-bold ' + (isUnlocked ? 'text-white' : 'text-gray-500') + '">' + displayTitle + '</div>';
                html += '<div class="text-sm ' + (isUnlocked ? 'text-gray-400' : 'text-gray-600') + '">' + displayDesc + '</div>';
                if (showUnlockedHint) {
                    html += '<div class="text-xs text-gray-600 mt-1">未解锁</div>';
                }
                html += '</div></div></div>';
            });
            
            html += '</div>';
            html += '<button onclick="this.closest(\'.fixed\').remove()" class="mt-6 w-full px-8 py-3 bg-[#c41e3a] text-white rounded-full hover:bg-[#e63950] transition-all">关闭</button>';
            html += '</div></div>';
            
            const modal = document.createElement('div');
            modal.innerHTML = html;
            document.body.appendChild(modal);
        }

        function showJourneyHistory() {
            let history = [];
            try {
                const saved = localStorage.getItem("chinese_truck_adventure_journey_history");
                if (saved) history = JSON.parse(saved);
            } catch (e) {}

            let html = '<div class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 overflow-y-auto p-4">';
            html += '<div class="bg-[#1a1a2e] border-2 border-[#c41e3a] rounded-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto text-area-scroll">';
            html += '<h2 class="text-2xl font-bold text-[#c41e3a] mb-6 text-center">历史历程</h2>';
            html += '<p class="text-gray-400 text-sm mb-4 text-center">回顾你之前的旅途</p>';

            if (history.length === 0) {
                html += '<div class="text-center text-gray-500 py-12">暂无旅途记录，完成一局游戏后即可在此查看。</div>';
            } else {
                html += '<div class="space-y-4">';
                history.forEach((j, i) => {
                    const date = new Date(j.timestamp);
                    const dateStr = date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0') + '-' + String(date.getDate()).padStart(2, '0') + ' ' + String(date.getHours()).padStart(2, '0') + ':' + String(date.getMinutes()).padStart(2, '0');
                    html += '<div class="p-4 rounded-lg border-2 border-gray-700 bg-gray-800/40 hover:border-[#c41e3a]/60 transition-colors">';
                    html += '<div class="flex items-center justify-between mb-2">';
                    html += '<span class="font-bold text-white text-lg">' + (j.endingTitle || j.endingType) + '</span>';
                    html += '<span class="text-gray-500 text-xs">' + dateStr + '</span>';
                    html += '</div>';
                    html += '<div class="text-sm text-gray-400 space-y-1">';
                    html += '<div>行驶里程：<span class="text-[#c41e3a] font-semibold">' + (j.mileage || 0) + ' km</span></div>';
                    if (j.passengers && j.passengers.length > 0) {
                        html += '<div>同行乘客：<span class="text-gray-300">' + j.passengers.join('、') + '</span></div>';
                    }
                    if (j.sessionAchievements && j.sessionAchievements.length > 0) {
                        html += '<div class="text-xs text-green-400/90 mt-1">达成成就：' + j.sessionAchievements.length + ' 个</div>';
                    }
                    html += '</div></div>';
                });
                html += '</div>';
            }

            html += '<button onclick="this.closest(\'.fixed\').remove()" class="mt-6 w-full px-8 py-3 bg-[#c41e3a] text-white rounded-full hover:bg-[#e63950] transition-all">关闭</button>';
            html += '</div></div>';

            const modal = document.createElement('div');
            modal.innerHTML = html;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
