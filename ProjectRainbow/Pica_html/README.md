# 无人红色皮卡的安保之旅

## 写在前面

1、以cdn引入方式使用了Tailwindcss

2、如果最后仍是网页端的话，可以扔回给第一棒进行服务器部署

3、很文字，很冒险，很红色皮卡

## 游戏特色

- **全汉字视觉风格**：游戏中的所有图形（皮卡、公路、乘客、事件）都由汉字组成
- **动态事件系统**：每行驶一段距离会触发随机事件，玩家的选择影响游戏进程
- **乘客收集机制**：可以邀请各种生物上车，改变皮卡的外观
- **Cookie 存档系统**：自动保存游戏进度，支持长期游玩
- **多结局设计**：包含正常结局和游戏结束（被骚福瑞打爆）
- **事件前奏动画**：道路逐渐减速，触发字从右侧滑入，增强沉浸感

## 游戏玩法

1. 点击index.html打开游戏，点击 START 开始你的安保之旅
2. 皮卡会自动在文字公路上行驶
3. 每输出 2 行文本会触发一个随机事件
4. 阅读事件描述，做出你的选择
5. 不同的选择会带来不同的结果：
   - 邀请乘客上车，改变皮卡外观
   - 无视事件，继续独自前行
   - 错误的选择可能导致游戏结束
6. 所有事件只触发一次，体验完整的故事

## 详细文件结构

### HTML 文件

#### `index.html` - 游戏开始页面
- **功能**：游戏入口，展示标题和开始按钮
- **元素**：
  - 游戏标题"红色皮卡的安保之旅"
  - 背景装饰汉字（小、心、福、瑞）
  - START 按钮：进入游戏
  - 重新开始按钮：清除 Cookie 存档

#### `game.html` - 游戏主页面
- **功能**：核心游戏画面和交互
- **区域**：
  - **公路区域**：横向单行文字流动（路、道、鹿等字符）
  - **皮卡显示**：5行13列汉字组成的红色皮卡
  - **事件触发字容器**：用于显示事件前奏动画（如"鹿"、"猎"、"福"字滑入）
  - **文本对话区**：显示游戏日志和事件描述
  - **返回按钮**：返回开始页面

### JavaScript 文件

#### `js/events_data.js` - 事件数据配置
包含所有游戏事件、皮卡模板和全局配置。

**`GAME_EVENTS` - 事件定义**

| 事件 ID | 中文名 | 触发条件 | 选项数 | 特殊效果 |
|---------|--------|----------|--------|----------|
| `deer` | 🦌 鹿 | 无条件 | 3 | 邀请上车可解锁猎人事件 |
| `hunter` | 🏹 猎人 | 需要鹿在车上 | 4 | 可选择交出鹿或分享食物 |
| `rain` | 🌧️ 大雨 | 无条件 | 2 | 纯场景事件 |
| `saofurry` | 🦊 骚福瑞 | 无条件 | 3 | 错误选择导致游戏结束 |

**`TRUCK_TEMPLATES` - 皮卡显示模板**

定义了 4 种皮卡外观状态：
- `default`：默认状态（无乘客）
- `deer`：有鹿在车上（第1行显示金色"鹿"）
- `hunter`：有猎人和鹿（第5行显示棕色"猎人"）
- `saofurry`：有骚福瑞（第2行显示骚粉色"福"）

每种模板都是 5 行 × 13 列的汉字数组，通过不同字符的颜色和位置表现皮卡外观。

**`EVENT_TRIGGER_CHARS` - 事件触发字配置**

定义事件触发时的滑入动画字符：
- 鹿事件："鹿"字，金色 `#d4a574`
- 猎人事件："猎"字，棕色 `#8b7355`
- 骚福瑞事件："福"字，骚粉色 `#ff69b4`

**`GAME_CONFIG` - 游戏配置**

```javascript
{
  triggerInterval: 2,        // 每2行文本触发一次事件
  cookieExpiryDays: 3650,    // Cookie 保存10年
  cookieName: "chinese_truck_adventure_save",
  animation: {
    roadDeceleration: 2500,  // 道路减速动画2.5秒
    charSlideIn: 1500,       // 触发字滑入1.5秒
    charStay: 1000           // 停留1秒后显示弹窗
  }
}
```

#### `js/road.js` - 公路动画系统

控制公路文字的流动效果。

**核心变量**
- `roadCharsPool`：公路字符池 `['马', '鹿']`
- `maxRoadLength`：屏幕显示80个字符
- `roadSpeed`：更新间隔300ms（越小越快）
- `roadInterval`：setInterval 引用

**核心函数**

```javascript
initRoad()           // 初始化公路，填充随机字符
updateRoad()         // 更新公路：右侧添加新字符，左侧移除
renderRoad()         // 渲染公路到 DOM
startRoadAnimation() // 开始公路流动动画
pauseRoad()          // 暂停公路（事件触发时用）
resumeRoad()         // 恢复公路（事件结束后用）
gradualStopRoad()    // 逐渐减速停止（事件前奏动画）
```

**动画机制**

使用 `setInterval` 定时更新，每 `roadSpeed` 毫秒：
1. `currentRoadChars.push(getRandomRoadChar())` - 右侧添加新字符
2. `currentRoadChars.shift()` - 左侧移除旧字符
3. `renderRoad()` - 重新渲染整个公路

#### `js/text.js` - 游戏核心逻辑

包含游戏状态管理、存档系统、事件处理和文本生成。

**游戏状态 `gameState`**

```javascript
{
  textCount: 0,              // 文本输出计数（每2次触发事件）
  eventTriggered: false,     // 是否正在事件中（暂停文本生成）
  passengers: [],            // 乘客列表 ['鹿', '猎人', '骚福瑞']
  triggeredEvents: [],       // 已触发事件ID（避免重复）
  unlockedEvents: [],        // 已解锁事件ID（目前只用于猎人）
  currentTruckTemplate: 'default'  // 当前皮卡模板
}
```

**存档系统**

使用 Cookie 实现长期存档：
- `setCookie(name, value, days)`：设置 Cookie，自动 JSON 序列化
- `getCookie(name)`：获取 Cookie，自动 JSON 反序列化
- `saveGame()`：保存当前游戏状态
- `loadGame()`：加载存档，恢复游戏进度

**事件触发机制**

```javascript
checkEventTrigger()      // 每2行文本检查是否触发事件
findAvailableEvent()     // 查找可用事件（检查条件和解锁状态）
triggerEvent(event)      // 触发事件：暂停→减速→动画→弹窗
```

**事件处理流程**

1. `checkEventTrigger()` 检测文本计数
2. `findAvailableEvent()` 查找符合条件的事件
3. `triggerEvent()` 开始事件流程：
   - 暂停文本生成
   - `gradualStopRoad()` 道路逐渐减速（2.5秒）
   - `showTriggerChar()` 触发字从右侧滑入（1.5秒）
   - 停留1秒
   - `hideTriggerChar()` 隐藏触发字
   - `displayEventModal()` 显示事件弹窗
4. 玩家点击选项，调用 `handleEventChoice()`
5. 应用选择结果（添加乘客、修改皮卡、解锁事件等）
6. `resumeRoad()` 和 `resumeTextGeneration()` 恢复游戏

**游戏结束处理**

当选择骚福瑞的"哼哼哈嘿"选项时：
- 检测 `effects.gameOver: true`
- 调用 `showGameOver()` 显示游戏结束弹窗
- 显示"💥 游戏结束"和"皮卡被打爆了"
- 提供"重新开始"按钮（刷新页面）
- 不恢复游戏，不保存进度

**皮卡显示更新 `updateTruckDisplay()`**

根据 `currentTruckTemplate` 渲染皮卡：
- 遍历 5 行模板数据
- 根据字符类型应用不同颜色：
  - `皮、卡、后、车、厢、门、|、丨` → 红色 `#c41e3a`
  - `轮` → 灰色 `#63635E`
  - `鹿` → 金色 `#d4a574`
  - `猎、人` → 棕色 `#8b7355`
  - `福` → 骚粉色 `#ff69b4`
  - `黑` → 黑色（背景色，不可见）
- 应用发光动画 `animate-truck-glow`

## 事件详细说明

### 🦌 鹿事件（鹿）

**触发条件**：无条件，游戏开始即可遇到

**描述**：一只迷路的鹿站在公路中央，好奇地望着你的皮卡...它的眼睛里闪烁着智慧的光芒。它用眼神和你交流，似乎在乞求你的安保。

**选项**：

1. **接受这个委托！**
   - 鹿高兴地跳上了后车厢
   - 成为第一位乘客
   - 皮卡第1行显示金色"鹿"字
   - 解锁猎人事件

2. **鸣笛驱赶**
   - 鹿受惊跑进森林
   - 继续独自前行

3. **小心绕行**
   - 不打扰鹿
   - 鹿目送你远去

### 🏹 猎人事件（猎人）

**触发条件**：需要鹿在车上（condition.requiresPassenger: "鹿"）

**描述**：一位背着猎枪的猎人拦住了你的去路...他看到你的皮卡，眼中闪过一丝惊讶。

**选项**：

1. **加速逃离**
   - 甩掉猎人
   - 无事发生

2. **与猎人对话**
   - 假装没看见鹿
   - 猎人离开

3. **把鹿交给猎人**
   - 鹿悲伤地离开
   - 从乘客列表移除"鹿"
   - 恢复默认皮卡

4. **分享食物**
   - 猎人成为朋友
   - 猎人趴在车底（成为乘客）
   - 皮卡第5行显示棕色"猎人"

### 🌧️ 大雨事件（雨）

**触发条件**：无条件，只触发一次

**描述**：天空突然乌云密布，倾盆大雨瞬间降临，能见度急剧下降...

**选项**：

1. **冒雨前行**
   - 雨水模糊视线
   - 继续行驶

2. **停车等待**
   - 在大树下避雨
   - 雨停后继续

### 🦊 骚福瑞事件（骚福瑞）

**触发条件**：无条件

**描述**：路边突然出现一只神秘的生物...它有着奇异的外表，眼神中透着一丝狡黠。这就是传说中的骚福瑞！

**选项**：

1. **邀请上车**
   - 骚福瑞兴奋跳上车
   - 坐到副驾驶位置
   - 皮卡第2行显示骚粉色"福"字
   - 成为乘客

2. **无视/驱赶**
   - 冷漠地离开
   - 骚福瑞遗憾目送

3. **和骚福瑞哼哼哈嘿** 
   - 骚福瑞暴怒！
   - 展现惊人战斗力
   - **💥 游戏结束**
   - 皮卡被打爆
   - 显示游戏结束弹窗
   - 需要重新开始

## 皮卡状态变化图解

### 默认状态（无乘客）
```
黑黑黑黑黑黑皮卡皮卡皮黑黑
后车厢后车厢黑黑丨黑黑皮黑
皮卡皮轮卡车门车门车轮门卡
皮卡轮轮轮车门车门轮轮轮卡
黑黑黑轮黑黑黑黑黑黑轮黑黑
```

### 有鹿状态
```
黑黑鹿黑黑黑皮卡皮卡皮黑黑  ← 第1行第3个位置：金色"鹿"
后车厢后车厢黑黑丨黑黑皮黑
皮卡皮轮卡车门车门车轮门卡
皮卡轮轮轮车门车门轮轮轮卡
黑黑黑轮黑黑黑黑黑黑轮黑黑
```

### 有猎人和鹿状态
```
黑黑鹿黑黑黑皮卡皮卡皮黑黑  ← 第1行：金色"鹿"
后车厢后车厢黑黑丨黑黑皮黑
皮卡皮轮卡车门车门车轮门卡
皮卡轮轮轮车门车门轮轮轮卡
黑黑黑轮黑黑猎人黑黑轮黑黑  ← 第5行第7-8个位置：棕色"猎人"
```

### 有骚福瑞状态
```
黑黑鹿黑黑黑皮卡皮卡皮黑黑
后车厢后车厢黑黑丨黑福皮黑  ← 第2行第11个位置：骚粉色"福"
皮卡皮轮卡车门车门车轮门卡
皮卡轮轮轮车门车门轮轮轮卡
黑黑黑轮黑黑猎人黑黑轮黑黑
```

## 细节

### 动画系统

**公路流动动画**
- 使用 `setInterval` 定时更新
- 每次更新：数组 `push` + `shift` + 重新渲染
- 速度通过调整 `setInterval` 的间隔时间控制

**事件前奏动画**
- 道路减速：逐步增加 `roadSpeed`，分60步执行
- 触发字滑入：CSS `transition` + `transform: translateX()`
- 使用 `linear` 匀速动画，避免回弹效果

### 颜色方案

| 元素 | 颜色值 | 说明 |
|------|--------|------|
| 皮卡主体 | `#c41e3a` | 红色 |
| 鹿 | `#d4a574` | 金色 |
| 猎人 | `#8b7355` | 棕色 |
| 骚福瑞 | `#ff69b4` | 骚粉色 |
| 车轮 | `#63635E` | 灰色 |
| 背景 | `#0d0d0d` | 近黑色 |
